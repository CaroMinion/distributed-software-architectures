@page
@model DetailModel
@{
    ViewData["Title"] = "Home page";
}

<div class="d-flex justify-content-between mb-2">
    <p class="lead">Guest <b>ID @Model.Guest</b> with @Model.Orders.Count() order(s) </p>

    <div class="btn-toolbar">
        <div class="btn-group mr-2" role="group">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#order-menu" data-remote="@Url.Page("../Menu",new {guest = Model.Guest})">
                + Place new order
            </button>
        </div>
        <div class="btn-group" role="group">
            @if(Model.Bill != null)
            {    
                <div class="input-group">
                    <div class="input-group-prepend">
                        <form method="POST" class="btn btn-outline-secondary">
                            <input class="btn" type="submit" asp-route-guest="@Model.Guest" asp-page-handler="RequestBill" value="Request an updated bill" />
                        </form>
                    </div>
                    <span class="input-group-text">
                        Bill from @Model.Bill.BillFrom.ToShortTimeString(): @Model.Bill.BilledItems items&nbsp;<b>@Model.Bill.TotalSum €</b>
                    </span>
                    <div class="input-group-append">
                        <button type="button" class="btn btn-outline-primary" data-toggle="modal" data-target="#pay-bill" data-remote="@Url.Page("../Billing/Payment",new {guest = Model.Guest})">
                            Pay all orders
                        </button>
                    </div>
                </div>
            } else {
                <form method="POST" class="btn btn-outline-secondary h-100">
                    <input class="btn" type="submit" asp-page-handler="RequestBill" asp-route-guest="@Model.Guest" value="Request bill" />
                </form>
            }
        </div>
    </div>
</div>

<vc:bills guest="@Model.Guest"></vc:bills>
<partial name="_Orders" for="@Model.Orders" />

<div class="modal" tabindex="-1" id="order-menu" data->
  <div class="modal-dialog modal-xl">
  </div>
</div>

<div class="modal" tabindex="-1" id="pay-bill" data->
  <div class="modal-dialog modal-xl">
  </div>
</div>

@section Scripts {
    <script>
        $(function(){
            $('#order-menu').on('show.bs.modal', event =>{
                $($(event.relatedTarget).data('target') + ' .modal-dialog').load($(event.relatedTarget).data("remote"));
            });
            $('#pay-bill').on('show.bs.modal', event =>{
                $($(event.relatedTarget).data('target') + ' .modal-dialog').load($(event.relatedTarget).data("remote"));
            });
        })
    </script>
}